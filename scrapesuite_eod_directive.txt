ScrapeSuite — End-of-Day (EOD) Process Directive for Cursor

Purpose
-------
Freeze current context so Cursor can rehydrate seamlessly next session.
Cursor must treat this document as the handoff note and follow the boot sequence below.

Tonight: Minimal Steps (run these before you stop)
-------------------------------------------------
PowerShell:
  # 1) Format, lint, and test; store logs
  python -m ruff format .
  python -m ruff check . | Tee-Object -FilePath .\logs\lint_$(Get-Date -UFormat %Y%m%dT%H%M%S).log
  pytest -q | Tee-Object -FilePath .\logs\tests_$(Get-Date -UFormat %Y%m%dT%H%M%S).log

  # 2) Snapshot Python environment
  python -m pip freeze | Out-File -Encoding utf8 .\requirements-lock.txt

  # 3) Commit to a WIP branch (context freeze)
  git checkout -b chore/context-freeze
  git add -A
  git commit -m "chore: context freeze — EOD notes and logs"
  git push -u origin chore/context-freeze

Create/Update the Handoff Notes
-------------------------------
File: docs/SESSION_NOTES.md
Template:
  # Session Notes — YYYY-MM-DD

  ## What changed today
  - Brief bullet list (e.g., Implemented Option B across connectors; moved example jobs; fixed FDA list_parser; added custom stubs.)

  ## Decisions (source of truth)
  - Q1: Option B — connectors take entry_url in __init__; collect() unchanged.
  - Q2: Provide stubs (custom_list/custom) so “custom” runs offline OOTB.
  - Q3: Fixtures use synthetic FDA-style slugs (2 relative + 1 absolute).

  ## Open questions for next session
  - (List any uncertainties.)

  ## Next 3 actions (bulletproof handoff)
  1. FDA tests: absolute URL via urljoin + slug id + next_cursor
  2. Pytest warns: DeprecationWarning when entry_url=None
  3. Ensure run-all ignores examples/jobs

  ## Quick runbook
  python -m ruff format .
  python -m ruff check .
  pytest -q
  python -m scrapesuite.cli init
  python -m scrapesuite.cli run .\jobs\custom_*.yml --offline true --max-items 10
  python -c "import glob,pandas as pd; p=sorted(glob.glob(r'data\cache\**\*.parquet', recursive=True))[-1]; print(p); df=pd.read_parquet(p); print(df[['id','title','url']].head(5).to_string(index=False))"

Commit notes if modified:
  git add docs\SESSION_NOTES.md
  git commit -m "docs: add EOD session notes"
  git push

Bootstrap File for Cursor (one-time; update if needed)
------------------------------------------------------
File: docs/CURSOR_BOOTSTRAP.md
Contents:
  # Cursor Bootstrap

  Use these files as the single source of truth:
  - scrapesuite_master_directive.txt
  - docs/SESSION_NOTES.md

  Mode: Conscientious. Start each session with PHASE 1 — read both files, list a minimal plan aligned to “Next 3 actions,” and ask clarifying questions. Do not modify files until I confirm.

First Message to Cursor Next Session
------------------------------------
Paste this into the chat to begin:
  Use `scrapesuite_master_directive.txt` and `docs/SESSION_NOTES.md` as the single source of truth. Operate in Conscientious Mode. Start with STAGE A — PHASE 1 (Plan & Questions) only: list files to touch, exact edits, tests to add; ask clarifying questions. Do not modify files until I confirm.

Artifacts Cursor Must Read on Boot
----------------------------------
- scrapesuite_master_directive.txt  (master plan and stages A–D)
- docs/SESSION_NOTES.md             (today’s decisions + next 3 actions)
- TODO.md (optional)                (focused checklist, if present)

Safety & Constraints (Cursor must honor)
----------------------------------------
- No new dependencies.
- Backward compatible CLI and job schema (unless explicitly approved).
- Offline-only tests (no network).
- Apply **Option B** for connector config across connectors.
- In PHASE 2, return UNIFIED DIFFS ONLY, then repo tree (depth=2), then validation commands.

End-of-Day Checklist Recap
--------------------------
[ ] ruff format/check run, pytest run, logs saved
[ ] requirements-lock.txt updated
[ ] All changes committed to `chore/context-freeze` and pushed
[ ] docs/SESSION_NOTES.md updated and committed
[ ] (If needed) docs/CURSOR_BOOTSTRAP.md present and up-to-date
[ ] Next-session message prepared (see “First Message…” above)

Notes
-----
- Keeping logs and notes in-repo makes Cursor’s context resilient across sessions.
- The master directive (scrapesuite_master_directive.txt) defines the architecture (Option B), stubs, fixtures, and staged roadmap.
